@startuml
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

LAYOUT_WITH_LEGEND()
SHOW_PERSON_OUTLINE()

title AS-IS: Схема интеграций для открытия депозита (банк "Стандарт")

' ===== Люди (участники) =====
Person(customer, "Клиент", "Хочет узнать ставку и открыть депозит")
Person(callOp, "Оператор кол-центра", "Принимает звонки, заводит обращение")
Person(branchEmp, "Сотрудник отделения (фронт-офис)", "Оформляет депозит в АБС, печатает/подписывает документы")
Person(depBack, "Сотрудник бэк-офиса депозитов", "Считает/согласует ставку, обрабатывает заявки")
Person(credBack, "Сотрудник бэк-офиса кредитов", "Даёт данные по кредитному риску (ограничение доступа)")

' ===== Системы и артефакты =====
System_Boundary(bank, "Банк") {
  Container(abs, "АБС", "Delphi + Oracle (PL/SQL)", "Учет депозитов/кредитов, обработка заявок/обращений")
  Container(ccSys, "Система кол-центра", "React + Java + PostgreSQL", "Фиксация обращений (CRM/кол-центр)")
  Container(sms, "SMS-шлюз", "Интеграция с телеком-оператором", "Отправка SMS клиентам")

  ' важно показать как есть (ручные и «полу-ИТ» каналы)
  Container(excel, "Excel (расчёт ставок)", "XLSX", "Ручной расчёт ставок и ежедневные обновления")
  Container(email, "Email", "Почта", "Передача запросов/ответов и Excel-файлов")
}

' (контекстно) интернет-банк существует, но в AS-IS депозиты там не открывают
Container_Ext(ib, "Интернет-банк", "ASP.NET + MS SQL", "Платежи/текущие счета; депозиты пока офлайн")

' ===== Связи (интеграции / обмены данными) =====

' Сценарий А: клиент звонил заранее
Rel(customer, callOp, "Звонок: уточняет условия депозита", "Телефон")
Rel(callOp, ccSys, "Создаёт обращение", "Web UI")
Rel(ccSys, abs, "Передаёт обращение в АБС", "Интеграция")

Rel(depBack, abs, "Берёт обращения/заявки (из кол-центра)", "Десктоп-клиент/внутренний доступ")
Rel(depBack, excel, "Ручной расчёт ставки (ежедневно)", "Ручной ввод")
Rel(excel, email, "Отправка Excel/ставок", "Email + XLSX")
Rel(email, depBack, "Получает ежедневные данные/обновления", "Email")

Rel(depBack, abs, "Фиксирует рассчитанную ставку по заявке", "Ввод в АБС")
Rel(abs, sms, "Триггер на отправку уведомления", "Интеграция")
Rel(sms, customer, "SMS: ставка определена, приходите в отделение", "SMS")

' Сценарий B: клиент пришёл без звонка
Rel(customer, branchEmp, "Приходит в отделение, просит открыть депозит", "Офлайн")
Rel(branchEmp, email, "Запрос ставки в бэк-офис", "Email")
Rel(email, depBack, "Получает запрос", "Email")
Rel(depBack, excel, "Считает ставку (при необходимости)", "Ручной ввод")
Rel(depBack, email, "Отправляет ставку в отделение", "Email")
Rel(email, branchEmp, "Получает ставку и озвучивает клиенту", "Email")

Rel(branchEmp, abs, "Создаёт депозит + загружает документы", "Десктоп-клиент (ручной ввод)")

' Спецставки: нужен кредитный риск (через ограничения доступа)
Rel(depBack, email, "Запрос данных по кредитному риску (для спецставки)", "Email")
Rel(email, credBack, "Получает запрос", "Email")
Rel(credBack, abs, "Смотрит риск в своём разделе АБС", "Десктоп-клиент")
Rel(credBack, email, "Отправляет данные по риску", "Email")
Rel(email, depBack, "Получает данные, учитывает в Excel", "Email")

' Контекст: интернет-банк не участвует в депозите (AS-IS)
Rel(customer, ib, "Платежи/текущие счета (не депозиты)", "Web")
Rel(ib, abs, "Интеграция напрямую с БД/данными АБС", "Прямое подключение")

@enduml
